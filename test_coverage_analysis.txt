ELLE2 RUST CODEBASE - TEST COVERAGE ANALYSIS
=============================================

SUMMARY OF FINDINGS:
- Total source files analyzed: 98 Rust modules
- Modules WITH tests: 30 (30.6%)
- Modules WITHOUT tests: 68 (69.4%)

CRITICAL GAPS BY PRIORITY:

=== TIER 1: HIGH-PRIORITY MODULES (Recently Refactored, No Tests) ===

1. **src/primitives/** (Refactored 2025-02-05)
   - Recent split from monolithic primitives module (commit e0a94f0)
   - Modules without tests:
     * arithmetic.rs (161 lines, 6 public functions)
     * comparison.rs (69 lines, 5 public functions)
     * concurrency.rs (62 lines, 4 public functions)
     * debug.rs (169 lines, 8 public functions)
     * display.rs (88 lines, 5 public functions)
     * exception.rs (87 lines, 4 public functions)
     * file_io.rs (405 lines, 20 public functions) ⚠️ LARGE MODULE
     * higher_order.rs (71 lines, 4 public functions)
     * higher_order_def.rs (77 lines, 4 public functions)
     * list.rs (114 lines, 6 public functions)
     * logic.rs (56 lines, 5 public functions)
     * macros.rs (61 lines, 4 public functions)
     * math.rs (151 lines, 10 public functions)
     * meta.rs (67 lines, 4 public functions)
     * module_init.rs (126 lines, 6 public functions)
     * module_loading.rs (85 lines, 4 public functions)
     * package.rs (73 lines, 4 public functions)
     * registration.rs (356 lines, 9 public functions)
     * string.rs (346 lines, 26 public functions) ⚠️ LARGE MODULE
     * structs.rs (129 lines, 6 public functions)
     * table.rs (132 lines, 7 public functions)
     * type_check.rs (76 lines, 4 public functions)
     * utility.rs (58 lines, 5 public functions)
     * vector.rs (82 lines, 7 public functions)

   ONLY HAS TESTS:
     ✓ json.rs (1076 lines, complex marshaling)
     ✓ signaling.rs (88 lines, exception signaling)

2. **src/ffi/marshal/** (Refactored 2025-02-03, commit a13c756)
   - Recent split from monolithic marshal module
   - Modules without tests:
     * cvalue.rs (46 lines, basic enum wrapper)
     * union_marshal.rs (85 lines, 2 public functions)

   ONLY HAS TESTS:
     ✓ array_marshal.rs
     ✓ conversions.rs
     ✓ field_packing.rs
     ✓ mod.rs
     ✓ struct_marshal.rs

3. **src/ffi/primitives/** (New FFI primitives module)
   - ENTIRE MODULE lacks unit tests (44 lines in mod.rs)
   - Modules without tests:
     * callbacks.rs (126 lines, 4 public functions)
     * calling.rs (150 lines, 2 public functions) ⚠️ Complex FFI calling
     * context.rs (50 lines, 6 public functions)
     * enums.rs (176 lines, 4 public functions)
     * handlers.rs (253 lines, 10 public functions) ⚠️ LARGEST MODULE
     * library.rs (71 lines, 4 public functions)
     * memory.rs (171 lines, 12 public functions)
     * mod.rs (44 lines, wrapper)
     * types.rs (35 lines, 1 public function)
     * wrappers.rs (18 lines, minimal)

   ONLY HAS TESTS:
     ✓ unions.rs (161 lines with tests)

4. **src/vm/scope/** (Refactored 2025-02-01, commit c0be9f1)
   - Recent split from monolithic scope module
   - Modules without tests:
     * handlers.rs (63 lines, 4 public functions)
     * mod.rs (36 lines, main scope interface)

   ONLY HAS TESTS:
     ✓ runtime_scope.rs
     ✓ scope_stack.rs

=== TIER 2: COMPILER MODULES (Core Language Infrastructure) ===

5. **src/compiler/** (Critical for language correctness)
   - Modules without tests:
     * analysis.rs (151 lines, 2 public functions)
       - analyze_capture_usage() - used for closure optimization
       - analyze_free_vars() - identifies free variables in expressions
       SHOULD HAVE: Unit tests for variable analysis algorithm
     
     * capture_resolution.rs (163 lines, 1 public function)
       - resolve_captures() - CRITICAL: fixes capture indices in nested lambdas
       - Complex multi-phase environment layout resolution
       SHOULD HAVE: Tests for nested closure capture resolution
     
     * compile.rs (251 lines, 1 public function)
       - compile_expr() - main compilation entry point
       - Compiles AST to bytecode
       SHOULD HAVE: Bytecode emission tests, variable handling tests
     
     * converters.rs (270 lines, 1 public function)
       - value_to_expr() - CRITICAL: converts Value AST to Expr AST
       - Handles complex pattern extraction and environment setup
       SHOULD HAVE: Tests for conversion edge cases
     
     * patterns.rs (44 lines, 1 public function)
       - value_to_pattern() - pattern construction
       SHOULD HAVE: Basic pattern conversion tests
     
     * ast.rs (98 lines, type definitions only)
     * bytecode_debug.rs (58 lines, debugging utility)
     * macros.rs (62 lines, 3 public functions)
     * mod.rs (36 lines, module interface)

   ONLY HAS TESTS:
     ✓ bytecode.rs (test_bytecode_emission, test_constant_deduplication)
     ✓ exception_registry.rs
     ✓ linter/* (all linter modules have tests)
     ✓ scope.rs
     ✓ symbol_index.rs

=== TIER 3: VM MODULES (Runtime Execution) ===

6. **src/vm/** (Execution engine, 1084 total lines)
   - Modules without tests:
     * arithmetic.rs (74 lines, inline operations)
     * closure.rs (39 lines, 1 public function)
       - handle_make_closure() - creates closures at runtime
       SHOULD HAVE: Closure creation and environment tests
     
     * comparison.rs (65 lines, inline operations)
     * control.rs (39 lines, control flow operations)
     * data.rs (55 lines, data operations)
     * literals.rs (14 lines, literal loading)
     * stack.rs (28 lines, stack structure)
     * types.rs (33 lines, type definitions)
     * variables.rs (97 lines, variable operations)
     * mod.rs (433 lines, main VM loop and execution) ⚠️ LARGEST
     * core.rs (208 lines, VM structure and utilities)

   ONLY HAS TESTS:
     ✓ scope/runtime_scope.rs
     ✓ scope/scope_stack.rs

=== TIER 4: ERROR HANDLING & UTILITIES ===

7. **src/error.rs** (20 lines)
   - Has tests ✓

8. **src/reader.rs** - Has tests ✓
9. **src/repl.rs** - Has tests ✓
10. **src/symbol.rs** - Has tests ✓
11. **src/value.rs** - Has tests ✓

NOTE: src/lib.rs and src/main.rs don't need unit tests (crate integration points)

=== MODULES WITH INSUFFICIENT TESTS ===

Even modules WITH tests may need more coverage:

Module                          | Current Tests | Need More
--------------------------------------------------
src/compiler/bytecode.rs        | 2 basic       | Full instruction coverage
src/ffi/call.rs                 | Some          | Edge cases
src/ffi/loader.rs               | Basic         | Library loading edge cases
src/reader.rs                   | Basic         | Complex syntax
src/repl.rs                     | Minimal       | User interaction

