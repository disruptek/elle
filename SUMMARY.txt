ELLE-LINT ERROR MESSAGE HANDLING ANALYSIS - EXECUTIVE SUMMARY
==============================================================

ANALYSIS COMPLETE. Three comprehensive documents have been created:

1. elle_lint_analysis.md (Main Analysis)
   - Complete architectural overview
   - Detailed component breakdown
   - Two-tier error handling system
   - Source location tracking mechanisms
   - Output formatting strategies

2. elle_lint_quick_reference.txt (Quick Lookup)
   - 9 key files with descriptions
   - Architecture summary
   - Error message structure
   - Implementation patterns
   - Rule definitions

3. elle_lint_code_examples.md (Code Reference)
   - 10 complete code examples
   - Creation patterns
   - Propagation strategies
   - Filtering and formatting
   - Testing patterns


KEY FINDINGS
============

ARCHITECTURE: Two-tier design
  
  TIER 1: Compiler Linter (Core)
  - Location: src/compiler/linter/
  - Uses SourceLoc struct for source tracking
  - Operates on AST (Expr with location info)
  - Produces basic diagnostics
  - Implements rules: naming convention, arity mismatch

  TIER 2: Elle-Lint Wrapper (User-facing)
  - Location: elle-lint/src/
  - Wraps compiler linter
  - Enhanced human-readable formatting
  - JSON output support
  - Severity filtering
  - CLI interface


SOURCELOC INFRASTRUCTURE
========================

File: /home/adavidoff/git/elle3/src/reader/token.rs

struct SourceLoc {
    pub file: String,    // Source file name
    pub line: usize,     // Line number (1-based)
    pub col: usize,      // Column number (1-based)
}

Key methods:
- new(file, line, col)        // Full location
- from_line_col(line, col)    // Line/col only
- start()                      // File start (1,1)
- Display impl: "file:line:col"


ERROR MESSAGE STRUCTURE
=======================

COMPILER LEVEL (src/compiler/linter/diagnostics.rs):
  - Diagnostic struct with Option<SourceLoc>
  - Severity enum: Info < Warning < Error
  - Code: diagnostic code (e.g., "W001")
  - Rule: rule name (e.g., "naming-kebab-case")
  - Message: detailed error message
  - Suggestions: optional fix suggestions

ELLE-LINT LEVEL (elle-lint/src/diagnostics.rs):
  - Enhanced Diagnostic struct
  - Explicit file, line, column fields
  - Context: source code line
  - format_human(): visual formatting with caret
  - to_json(): structured JSON output


FORMATTING OUTPUT
=================

HUMAN-READABLE:
  file:line:col severity: rule
    --> file:line
      |
    line | source code line here
      | ^
  
  error message text
  suggestions:
    - suggestion 1
    - suggestion 2

JSON:
  {
    "diagnostics": [
      {
        "severity": "warning",
        "code": "W001",
        "rule": "naming-kebab-case",
        "message": "...",
        "line": 5,
        "column": 2,
        "suggestions": [...]
      }
    ]
  }


IMPLEMENTED RULES
=================

W001: naming-kebab-case
  - Validates kebab-case identifiers
  - Allows single letters and suffixes (?, !)
  - Provides correction suggestions

W002: arity-mismatch
  - Validates function argument counts
  - Uses builtin_arity() lookup table
  - Covers: +, -, *, /, cons, first, rest, length, etc.


DATA FLOW
=========

Source File
  ↓ [Lexer]
Tokens with SourceLoc
  ↓ [Reader]
Values
  ↓ [value_to_expr]
Expr
  ↓ [ExprWithLoc wrapper]
(Expr, Option<SourceLoc>)
  ↓ [Compiler Linter]
Vec<Diagnostic> with SourceLoc
  ↓ [Elle-lint Wrapper]
Filtered by severity
  ↓ [Output Formatter]
Human-readable OR JSON
  ↓ [CLI]
Output + Exit Code


KEY PATTERNS
============

1. BUILDER PATTERN
   Diagnostic::new(...)
       .with_suggestions(vec![...])

2. OPTION HANDLING
   match &diagnostic.location {
       Some(loc) => /* full format */,
       None => /* fallback format */
   }

3. SEVERITY FILTERING
   if diagnostic.severity >= min_severity {
       /* include in output */
   }

4. LOCATION PROPAGATION
   Pass location through recursive AST traversal

5. GRACEFUL DEGRADATION
   Works with or without location information


FILE LOCATIONS
==============

Core Components:
  /home/adavidoff/git/elle3/src/reader/token.rs
  /home/adavidoff/git/elle3/src/compiler/linter/mod.rs
  /home/adavidoff/git/elle3/src/compiler/linter/diagnostics.rs
  /home/adavidoff/git/elle3/src/compiler/linter/rules.rs

Elle-Lint Wrapper:
  /home/adavidoff/git/elle3/elle-lint/src/lib.rs
  /home/adavidoff/git/elle3/elle-lint/src/main.rs
  /home/adavidoff/git/elle3/elle-lint/src/diagnostics.rs
  /home/adavidoff/git/elle3/elle-lint/src/rules/

Tests:
  /home/adavidoff/git/elle3/elle-lint/tests/integration_tests.rs


STRENGTHS
=========

1. Separation of Concerns
   - Compiler core separate from user interface
   - Makes it easy to integrate elsewhere

2. Source Location Tracking
   - SourceLoc struct tracks precise positions
   - Location info preserved through entire pipeline
   - Optional location handling (graceful degradation)

3. Multiple Output Formats
   - Human-readable with visual cues
   - Machine-parseable JSON
   - Configurable severity filtering

4. Extensible Rule System
   - Rules receive location info
   - Easy to add new rules
   - Built-in arity database for validation

5. Builder Pattern
   - Flexible diagnostic construction
   - Suggestions can be easily added/modified
   - Chainable API


EXAMPLE USAGE
=============

CLI:
  elle-lint test.l
  elle-lint src/ --format json
  elle-lint script.l --level error

Programmatic:
  let mut linter = Linter::new(config);
  linter.lint_file(path)?;
  println!("{}", linter.format_output());
  process::exit(linter.exit_code());


CONCLUSION
==========

Elle-lint implements a sophisticated error handling system with:
- Precise source location tracking (SourceLoc)
- Two-tier architecture (compiler + wrapper)
- Multiple output formats (human + JSON)
- Extensible rule system
- Graceful degradation for missing location info

The design cleanly separates concerns and makes it easy to:
- Add new linting rules
- Integrate the linter elsewhere
- Modify output formatting
- Track errors through transformations

